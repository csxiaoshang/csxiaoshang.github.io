---
title: java内存分配
date: 2019-12-04 22:09:38
categories: Java
---

### java内存区域

线程私有的：程序计数器、虚拟机栈、本地方法栈
线程公有的：方法区、堆

- 程序计数器

和操作系统的程序计数器类似，用于控制程序执行步数，计算跳转内存地址

- 虚拟机栈

用来存储方法执行时的局部变量、动态链接、方法出口等。

- 本地方法栈

用来存储java JNI调用的native方法的相关信息，和虚拟机栈类似

<!--more-->

- 方法区

用来存储常量、静态变量、类信息等信息，通俗来讲存储类的通用的模板数据

- 堆

存储几乎所有的实例化对象和数组，包括对象的实例变量。

Java7之后，String Pool被移到堆内，因为永久代空间有限，在大量使用字符串的场景下会出现OutOfMemoryError错误

- 直接内存

这不是虚拟机数据区的一部分，属于堆外内存。这样可以避免在java堆和native堆中来回复制数据。

### java内存模型

对于线程共享的静态变量、实例变量、和构成数组对象的元素是存储在堆中，算是常说的主内存。
而每个线程使用这些变量的时候则需要将其读取复制到自身的工作内存，处理后再写会主内存。
所以会有变量可见性问题，即不能及时看到变化。
对于关键字volatile来说，其修饰的变量读写直接在主内存中，不涉及到工作内存的读写，所有是保证可见性的。